/* Copyright 2020 ZSA Technology Labs, Inc <@zsa>
 * Copyright 2020 Jack Humbert <jack.humb@gmail.com>
 * Copyright 2020 Christopher Courtney, aka Drashna Jael're  (@drashna) <drashna@live.com>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */



#include "action.h"
#include "action_code.h"
#include "action_util.h"
#include "keycode.h"
#include QMK_KEYBOARD_H
#include "version.h"

#define HOME_A LCTL_T(KC_A)
#define HOME_S LALT_T(KC_S)
#define HOME_D LGUI_T(KC_D)
#define HOME_F LSFT_T(KC_F)

#define HOME_J RSFT_T(KC_J)
#define HOME_K RGUI_T(KC_K)
#define HOME_L RALT_T(KC_L)
#define HOME_SCLN RCTL_T(KC_SCLN)

enum layers {
    BAS,  // default layer
    NAV,    // navigation
    MSE, // mouse
    SYM,  // symbols
    MED,  // media keys
};

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
/* ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐ ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐
 * │       │  1  │  2  │  3  │  4  │  5  │       │ │       │  6  │  7  │  8  │  9  │  0  │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │  Q  │  W  │  E  │  R  │  T  │       │ │       │  Y  │  U  │  I  │  O  │  P  │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │ A/^ │ S/⎇ │ D/⌘ │ F/⇧ │  G  │       │ │       │  H  │ J/⇧ │ K/⌘ │ L/⎇ │ ;/^ │  ' "  │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┘ └───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │  Z  │  X  │  C  │  V  │  B  │                 │  N  │  M  │ , < │ . > │ / ? │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┘                 └─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │LT(NA│                             │LT(SY│     │     │     │       │
 * └───────┴─────┴─────┴─────┴─────┘                             └─────┴─────┴─────┴─────┴───────┘
 *                               ┌───────────────┐ ┌───────────────┐
 *                               │               │ │               │
 *                       ┌───────┼───────┬───────┤ ├───────┬───────┼───────┐
 *                       │LT(MSE,│LT(MED,│       │ │       │  DEL  │  ENT  │
 *                       └───────┴───────┴───────┘ └───────┴───────┴───────┘
 *                                                                      generated by [keymapviz] */
    [BAS] = LAYOUT_moonlander(
        _______,  KC_1,         KC_2,         KC_3,         KC_4,            KC_5,  _______,                   _______,  KC_6, KC_7,         KC_8,         KC_9,         KC_0,            _______,
        _______,  KC_Q,         KC_W,         KC_E,         KC_R,            KC_T,  _______,                  _______, KC_Y, KC_U,         KC_I,         KC_O,         KC_P,            _______,
        _______,  HOME_A, HOME_S, HOME_D, HOME_F,    KC_G,  _______,                   _______,  KC_H, HOME_J, HOME_K, HOME_L, HOME_SCLN, KC_QUOT,
        _______,  KC_Z,         KC_X,         KC_C,         KC_V,            KC_B,                                       KC_N, KC_M,         KC_COMM,      KC_DOT,       KC_SLSH, _______,
        _______,  _______,      _______,      _______,      LT(NAV, KC_TAB), _______,                          _______,  LT(SYM,KC_BSPACE), _______, _______, _______, _______,
                                                      LT(MSE, KC_SPC),  LT(MED, KC_ESC), _______,        _______,  KC_DEL, KC_ENT
    ),
/* ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐ ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐
 * │       │     │     │     │     │     │       │ │       │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │     │       │ │       │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │ L^  │ L⎇  │ L⌘  │ L⇧  │     │       │ │ CAPS  │  ◁  │  ▽  │  △  │  ▷  │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┘ └───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │     │                 │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┘                 └─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │                             │     │     │     │     │       │
 * └───────┴─────┴─────┴─────┴─────┘                             └─────┴─────┴─────┴─────┴───────┘
 *                               ┌───────────────┐ ┌───────────────┐
 *                               │               │ │               │
 *                       ┌───────┼───────┬───────┤ ├───────┬───────┼───────┐
 *                       │       │       │       │ │       │       │       │
 *                       └───────┴───────┴───────┘ └───────┴───────┴───────┘
 *                                                                      generated by [keymapviz] */
    [NAV] = LAYOUT_moonlander(
        _______,  _______, _______, _______, _______, _______,  _______,                                _______, _______, _______, _______,  _______, _______, _______,
        _______,  _______, _______, _______, _______, _______,  _______,                                _______, _______, _______, _______,  _______, _______, _______,
        _______,  KC_LCTL, KC_LALT, KC_LGUI, KC_LSFT, _______,  _______,                                KC_CAPS, KC_LEFT, KC_DOWN,   KC_UP, KC_RIGHT, _______, _______,
        _______,  _______, _______, _______, _______, _______,                                                   _______, _______, _______,  _______, _______, _______,
        _______,  _______, _______, _______, _______, _______,                                                   _______, _______, _______,  _______, _______, _______,
                                            _______,  _______,  _______,                                _______, _______, _______
    ),
/* ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐ ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐
 * │       │     │     │     │     │     │       │ │       │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │     │       │ │       │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │     │       │ │       │MSE ←│MSE ↓│MSE ↑│MSE →│     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┘ └───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │     │                 │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┘                 └─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │                             │BTN2 │     │     │     │       │
 * └───────┴─────┴─────┴─────┴─────┘                             └─────┴─────┴─────┴─────┴───────┘
 *                               ┌───────────────┐ ┌───────────────┐
 *                               │               │ │               │
 *                       ┌───────┼───────┬───────┤ ├───────┬───────┼───────┐
 *                       │       │       │       │ │       │ BTN3  │ BTN1  │
 *                       └───────┴───────┴───────┘ └───────┴───────┴───────┘
 *                                                                      generated by [keymapviz] */
    [MSE] = LAYOUT_moonlander(
        _______,  _______, _______, _______, _______, _______,  _______,                                _______, _______, _______, _______,  _______, _______, _______,
        _______,  _______, _______, _______, _______, _______,  _______,                                _______, _______, _______, _______,  _______, _______, _______,
        _______,  _______, _______, _______, _______, _______,  _______,                                _______, KC_MS_L, KC_MS_D, KC_MS_U,  KC_MS_R, _______, _______,
        _______,  _______, _______, _______, _______, _______,                                                   _______, _______, _______,  _______, _______, _______,
        _______,  _______, _______, _______, _______, _______,                                                   _______, KC_BTN2, _______,  _______, _______, _______,
                                            _______,  _______,  _______,                                _______, KC_BTN3, KC_BTN1
    ),
/* ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐ ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐
 * │       │     │     │     │     │     │       │ │       │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │     │       │ │       │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │     │       │ │       │MPRV │VOLD │VOLU │MNXT │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┘ └───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │     │                 │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┘                 └─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │     │                             │MUTE │     │     │     │       │
 * └───────┴─────┴─────┴─────┴─────┘                             └─────┴─────┴─────┴─────┴───────┘
 *                               ┌───────────────┐ ┌───────────────┐
 *                               │               │ │               │
 *                       ┌───────┼───────┬───────┤ ├───────┬───────┼───────┐
 *                       │       │       │       │ │       │       │ MPLY  │
 *                       └───────┴───────┴───────┘ └───────┴───────┴───────┘
 *                                                                      generated by [keymapviz] */
    [MED] = LAYOUT_moonlander(
        _______,  _______, _______, _______, _______, _______,  _______,                                _______, _______, _______, _______,  _______, _______, _______,
        _______,  _______, _______, _______, _______, _______,  _______,                                _______, _______, _______, _______,  _______, _______, _______,
        _______,  _______, _______, _______, _______, _______,  _______,                                _______, KC_MPRV, KC_VOLD, KC_VOLU,  KC_MNXT, _______, _______,
        _______,  _______, _______, _______, _______, _______,                                                   _______, _______, _______,  _______, _______, _______,
        _______,  _______, _______, _______, _______, _______,                                                   _______, KC_MUTE, _______,  _______, _______, _______,
                                            _______,  _______,  _______,                                _______, _______, KC_MPLY
    ),
/* ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐ ┌───────┬─────┬─────┬─────┬─────┬─────┬───────┐
 * │       │ F1  │ F2  │ F3  │ F4  │ F5  │       │ │       │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │  !  │  @  │  {  │  }  │  |  │       │ │       │     │     │     │     │     │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤ ├───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │  #  │  $  │  (  │  )  │  `  │       │ │       │     │ L⇧  │ L⌘  │ L⎇  │ L^  │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┼───────┘ └───────┼─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │  %  │  ^  │  [  │  ]  │  ~  │                 │     │     │     │     │ \ | │       │
 * ├───────┼─────┼─────┼─────┼─────┼─────┘                 └─────┼─────┼─────┼─────┼─────┼───────┤
 * │       │     │     │     │  =  │                             │     │     │     │     │       │
 * └───────┴─────┴─────┴─────┴─────┘                             └─────┴─────┴─────┴─────┴───────┘
 *                               ┌───────────────┐ ┌───────────────┐
 *                               │               │ │               │
 *                       ┌───────┼───────┬───────┤ ├───────┬───────┼───────┐
 *                       │  - _  │       │       │ │       │       │       │
 *                       └───────┴───────┴───────┘ └───────┴───────┴───────┘
 *                                                                      generated by [keymapviz] */
    [SYM] = LAYOUT_moonlander(
        _______,    KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,   _______,                                _______, _______, _______, _______,  _______, _______,  _______,
        _______, KC_EXLM, KC_AT,   KC_LCBR, KC_RCBR, KC_PIPE, _______,                                  _______, _______, _______, _______,  _______, _______, _______,
        _______, KC_HASH, KC_DLR,  KC_LPRN, KC_RPRN, KC_GRV,  _______,                                  _______, _______, KC_LSFT, KC_LGUI, KC_LALT,  KC_LCTL,  _______,
        _______, KC_PERC, KC_CIRC, KC_LBRC, KC_RBRC, KC_TILD,                                                    _______, _______, _______,  _______, KC_BSLS, _______,
        _______, _______, _______, _______, KC_EQL,  _______,                                           _______, _______, _______, _______,  _______, _______,
                                            KC_MINS, _______, _______,                                  _______,_______, _______
    ),

};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  switch (keycode) {
  case HOME_A:
    if (record->tap.count && record->event.pressed) {
      if (get_mods() & MOD_BIT(KC_LALT)) {
        unregister_mods(MOD_BIT(KC_LALT));
        tap_code(KC_S);
        tap_code(KC_A);
        add_mods(MOD_BIT(KC_LALT));
        return false;
      }
    }
    break;
  case HOME_D:
    if (record->tap.count && record->event.pressed) {
      if (get_mods() & MOD_BIT(KC_LSFT)) {
        unregister_mods(MOD_BIT(KC_LSFT));
        tap_code(KC_F);
        tap_code(KC_D);
        add_mods(MOD_BIT(KC_LSFT));
        return false;
      } else if (get_mods() & MOD_BIT(KC_LALT)) {
        unregister_mods(MOD_BIT(KC_LALT));
        tap_code(KC_S);
        tap_code(KC_D);
        add_mods(MOD_BIT(KC_LALT));
        return false;
      }
    }
    break;
  }
  return true;
};
